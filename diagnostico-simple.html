<!DOCTYPE html>
<html>
<head>
    <title>Diagnóstico Login</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Diagnóstico de Login</h1>
    <button onclick="verificarUsuarios()">Verificar Usuarios</button>
    <button onclick="crearUsuario()">Crear Usuario de Prueba</button>
    <div id="resultado"></div>

    <script>
        const supabase = window.supabase.createClient(
            'https://nuhxzshvwluaqgpvljwh.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51aHh6c2h2d2x1YXFncHZsandoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NTY1NzAyNywiZXhwIjoyMDgxMjMzMDI3fQ.JfdZ0R-BxZdbC--8wUqFuy6vcQnaHMb1Zlo_3uL0nlA'
        );

        async function verificarUsuarios() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<p>Verificando usuarios...</p>';

            try {
                const { data: usuarios, error } = await supabase
                    .from('usuarios')
                    .select('email, password, limiteNumeros');

                if (error) {
                    resultado.innerHTML = `<p style="color: red;">❌ Error: ${error.message}</p>
                    <p><strong>Solución:</strong> Crea la tabla ejecutando este SQL en Supabase:</p>
                    <pre>CREATE TABLE IF NOT EXISTS usuarios (
  id BIGSERIAL PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  telefono TEXT,
  limiteNumeros INTEGER DEFAULT 1,
  suscripcion_valida_hasta DATE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);</pre>`;
                    return;
                }

                if (!usuarios || usuarios.length === 0) {
                    resultado.innerHTML = '<p style="color: orange;">⚠️ No hay usuarios registrados</p>';
                } else {
                    let html = '<p style="color: green;">✅ Usuarios encontrados:</p><ul>';
                    usuarios.forEach((u, i) => {
                        html += `<li><strong>${u.email}</strong> - Password: ${u.password}</li>`;
                    });
                    html += '</ul>';
                    resultado.innerHTML = html;
                }
            } catch (error) {
                resultado.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        async function crearUsuario() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<p>Creando usuario...</p>';

            try {
                const { data, error } = await supabase
                    .from('usuarios')
                    .insert([{
                        email: 'test@test.com',
                        password: '123456',
                        telefono: '+5491234567890',
                        limiteNumeros: 5
                    }])
                    .select();

                if (error) {
                    resultado.innerHTML = `<p style="color: red;">❌ Error: ${error.message}</p>`;
                } else {
                    resultado.innerHTML = `<p style="color: green;">✅ Usuario creado exitosamente!</p>
                    <p><strong>Email:</strong> test@test.com</p>
                    <p><strong>Password:</strong> 123456</p>`;
                }
            } catch (error) {
                resultado.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>